<script>
  document.addEventListener('DOMContentLoaded', () => {
    const FREE_GIFT_ID = '{{ settings.free_gift_product.selected_or_first_available_variant.id }}';
    const FREE_GIFT_THRESHOLD = {{ settings.free_gift_threshold }} * 100;


    const addGift = async (giftVariantId, quantity = 1) => {
      try {
        const res = await fetch('/cart/add.js', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify({
            id: giftVariantId,
            quantity: quantity,
            properties: { FREE_GIFT: true }
          })
        });

        if (!res.ok) {
          throw new Error(`Error: ${res.status}`);
        }

        const data = await res.json();
        console.log('Gift added:', data);
        return data;
      } catch (err) {
        console.error('Error adding gift:', err);
      }
    };

    const removeGift = async (lineItemKey) => {
      try {
        const res = await fetch('/cart/change.js', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            id: lineItemKey,
            quantity: 0
          })
        });

        if (!res.ok) throw new Error(`Error: ${res.status}`);

        const data = await res.json();
        console.log('Gift removed:', data);
        return data;
      } catch (err) {
        console.error('Error removing gift:', err);
      }
    };

        
    const getCart = async () => {
      const res = await fetch('/cart.js');
      if (!res.ok) throw new Error(`Error: ${res.status}`);
      return await res.json();
    };

    // Function: check if cart is eligible for free gift
    const isEligibleForGift = async () => {
      try {
        const cart = await getCart();
        const total = cart.total_price; // already in cents

        if (total >= FREE_GIFT_THRESHOLD) {
          console.log(`✅ Eligible for free gift! Cart total: ${total / 100}`);
          return true;
        } else {
          console.log(`❌ Not eligible. Cart total: ${total / 100}`);
          return false;
        }
      } catch (err) {
        console.error('Error checking eligibility:', err);
        return false;
      }
    };

  });
</script>
