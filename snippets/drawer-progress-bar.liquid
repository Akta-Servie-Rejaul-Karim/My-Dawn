<style>
  .free-shipping-progress {
    margin: 15px 0;
    text-align: center;
    font-size: 14px;
  }

  .progress-bar {
    height: 9px;
    border-radius: 8px;
    background: #E1E1E1;
    margin-bottom: 20px;
    position: relative;
    display: flex;
    justify-content: space-between;
    align-items: center;
  }

  .progress-fill,
  .progress-fill-2 {
    height: 100%;
    position: absolute;
    top: 0;
    left: 0;
    transition: width 0.4s ease;
    border-radius: 8px;
    z-index: 0;
  }

  .progress-fill {
    background: #D8BBD6;
    border-radius: 8px 0 0 8px;
  }

  .progress-fill-2 {
    background: #B28DB2;
    border-radius: 0 8px 8px 0;
  }

  .milestone {
    position: relative;
    z-index: 2;
    display: flex;
    width: 40px;
    height: 40px;
    padding: 7.5px;
    justify-content: center;
    align-items: center;
    border-radius: 20px;
    border: 1px solid #D8BBD6;
    background: #FFF;
    font-size: 16px;
    transition: all 0.3s ease;
  }

  .milestone.active {
    background: #D8BBD6;
    color: #fff;
  }
</style>

{% assign free_shipping_threshold = settings.free_shipping_threshold | times: 100 %}
{% assign free_gift_threshold = settings.free_gift_threshold | times: 100 %}
{% assign cart_total = cart.total_price %}

{%- assign stage1_percent = cart_total | times: 100 | divided_by: free_shipping_threshold | at_most: 100 -%}
{%- assign stage2_percent = cart_total
  | minus: free_shipping_threshold
  | times: 100
  | divided_by: free_gift_threshold
  | at_least: 0
  | at_most: 100
-%}

<div class="free-shipping-progress">
  <div class="progress-bar">
    <!-- Fill stages -->
    <div class="progress-fill" style="width: {{ stage1_percent }}%;"></div>
    {% if cart_total > free_shipping_threshold %}
      <div class="progress-fill-2" style="width: {{ stage2_percent }}%;"></div>
    {% endif %}

    <!-- Milestones -->
    <span class="milestone {% if cart_total >= free_shipping_threshold %}active{% endif %}">üöö</span>
    <span class="milestone {% if cart_total >= free_gift_threshold %}active{% endif %}">üéÅ</span>
  </div>

  <p class="progress-text">
    {% if cart_total >= free_gift_threshold %}
      üéÅ Congrats! You unlocked <strong>Free Gift + Free Shipping</strong>!
    {% elsif cart_total >= free_shipping_threshold %}
      üöö You unlocked <strong>Free Shipping</strong> ‚Äî add
      <strong>{{ free_gift_threshold | minus: cart_total | money }}</strong> more to get a Free Gift!
    {% else %}
      Add <strong>{{ free_shipping_threshold | minus: cart_total | money }}</strong> to unlock
      <strong>Free Shipping</strong>.
    {% endif %}
  </p>
</div>
